<div class="page-header">
  <h1>ðŸ“‹ Daily Planner</h1>
  <div class="date-nav">
    <%= link_to "< Prev", planner_items_path(date: (@date - 1.day).to_s), class: "btn btn-secondary" %>
    <span class="current-date"><%= @date.strftime("%A, %B %d, %Y") %></span>
    <%= link_to "Next >", planner_items_path(date: (@date + 1.day).to_s), class: "btn btn-secondary" %>
  </div>
  <%= link_to "+ New Task", new_planner_item_path(date: @date), class: "btn btn-primary" %>
</div>

<% if @planner_items.any? %>
  <div class="items-list">
    <% @planner_items.each do |item| %>
      <div class="item-card <%= 'item-completed' if item.completed %>">
        <div class="item-header">
          <h3><%= item.title %></h3>
          <% if item.time_of_day %>
            <span class="time-badge"><%= item.time_of_day.strftime("%I:%M %p") %></span>
          <% end %>
        </div>
        <% if item.notes.present? %>
          <p class="item-notes"><%= item.notes %></p>
        <% end %>
        <div class="item-actions">
          <%= link_to "Edit", edit_planner_item_path(item), class: "btn btn-sm btn-secondary" %>
          <%= link_to "Delete", planner_item_path(item), data: { turbo_method: :delete, turbo_confirm: "Delete this task?" }, class: "btn btn-sm btn-danger" %>
          <% unless item.completed %>
            <%= link_to "âœ“ Mark Done", planner_item_path(item, planner_item: { completed: true }), data: { turbo_method: :patch }, class: "btn btn-sm btn-success" %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="empty-state-box">
    <p>No tasks for this day.</p>
    <%= link_to "+ Add a Task", new_planner_item_path(date: @date), class: "btn btn-primary" %>
  </div>
<% end %>

<hr class="section-divider">

<div id="todo-list" class="section-header">
  <h2>âœ… To-Do List</h2>
  <%= link_to "+ Add Item", new_todo_item_path, class: "btn btn-primary" %>
</div>

<% pending_todos = @todo_items.reject(&:completed) %>
<% done_todos    = @todo_items.select(&:completed) %>

<% if @todo_items.any? %>
  <% if pending_todos.any? %>
    <h3 style="margin-bottom: 0.6rem; color: var(--text);">Pending (<%= pending_todos.size %>)</h3>
    <div class="items-list">
      <% pending_todos.each do |item| %>
        <div class="item-card">
          <div class="item-header">
            <h3><%= item.title %></h3>
            <span class="badge <%= item.priority == 3 ? 'badge-info' : item.priority == 2 ? 'badge-pending' : 'badge-success' %>">
              <%= TodoItem::PRIORITIES[item.priority] %>
            </span>
          </div>
          <% if item.notes.present? %>
            <p class="item-notes"><%= item.notes %></p>
          <% end %>
          <div class="item-actions">
            <%= link_to "Edit", edit_todo_item_path(item), class: "btn btn-sm btn-secondary" %>
            <%= link_to "âœ“ Done", todo_item_path(item, todo_item: { completed: true }), data: { turbo_method: :patch }, class: "btn btn-sm btn-success" %>
            <%= link_to "Delete", todo_item_path(item), data: { turbo_method: :delete, turbo_confirm: "Delete this item?" }, class: "btn btn-sm btn-danger" %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>

  <% if done_todos.any? %>
    <h3 style="margin: 1.2rem 0 0.6rem; color: var(--text-muted);">Completed (<%= done_todos.size %>)</h3>
    <div class="items-list">
      <% done_todos.each do |item| %>
        <div class="item-card item-completed">
          <div class="item-header">
            <h3><%= item.title %></h3>
            <span class="badge badge-success">âœ“ Done</span>
          </div>
          <div class="item-actions">
            <%= link_to "Reopen", todo_item_path(item, todo_item: { completed: false }), data: { turbo_method: :patch }, class: "btn btn-sm btn-secondary" %>
            <%= link_to "Delete", todo_item_path(item), data: { turbo_method: :delete, turbo_confirm: "Delete this item?" }, class: "btn btn-sm btn-danger" %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
<% else %>
  <div class="empty-state-box">
    <p>Your to-do list is empty.</p>
    <%= link_to "+ Add Your First Item", new_todo_item_path, class: "btn btn-primary" %>
  </div>
<% end %>
