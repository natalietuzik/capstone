<div class="dashboard">
  <h1>Welcome back! ðŸ‘‹</h1>
  <p class="date-display">Today is <%= @today.strftime("%A, %B %d, %Y") %></p>

  <div class="dashboard-grid">
    <div class="card">
      <h2>ðŸ“‹ Today's Tasks</h2>
      <% if @todays_tasks.any? %>
        <ul class="task-list">
          <% @todays_tasks.each do |item| %>
            <li class="<%= 'completed' if item.completed %>">
              <%= item.title %>
              <% if item.time_of_day %>
                <span class="time-badge"><%= item.time_of_day.strftime("%I:%M %p") %></span>
              <% end %>
            </li>
          <% end %>
        </ul>
      <% else %>
        <p class="empty-state">No tasks for today.</p>
      <% end %>
      <%= link_to "+ Add Task", new_planner_item_path, class: "btn btn-secondary" %>
    </div>

    <div class="card">
      <h2>ðŸ’Š Medications</h2>
      <% if @medications.any? %>
        <ul class="med-list">
          <% @medications.each do |med| %>
            <% log = @todays_med_logs.find { |l| l.medication_id == med.id } %>
            <li>
              <%= med.name %>
              <span class="badge <%= log&.taken ? 'badge-success' : 'badge-pending' %>">
                <%= log&.taken ? "âœ“ Taken" : "Pending" %>
              </span>
            </li>
          <% end %>
        </ul>
      <% else %>
        <p class="empty-state">No medications tracked yet.</p>
      <% end %>
      <%= link_to "Manage Medications", mental_health_entries_path, class: "btn btn-secondary" %>
    </div>

    <div class="card">
      <h2>ðŸ§  Mental Health Today</h2>
      <% if @todays_mental_health %>
        <div class="health-stats">
          <div class="stat">
            <span class="stat-label">Mood</span>
            <span class="stat-value"><%= @todays_mental_health.mood %>/10</span>
          </div>
          <div class="stat">
            <span class="stat-label">Anxiety</span>
            <span class="stat-value"><%= @todays_mental_health.anxiety %>/10</span>
          </div>
          <% if @todays_mental_health.sleep_hours %>
          <div class="stat">
            <span class="stat-label">Sleep</span>
            <span class="stat-value"><%= @todays_mental_health.sleep_hours %>h</span>
          </div>
          <% end %>
        </div>
        <%= link_to "Edit Entry", edit_mental_health_entry_path(@todays_mental_health), class: "btn btn-secondary" %>
      <% else %>
        <p class="empty-state">No entry for today.</p>
        <%= link_to "+ Log Today's Entry", new_mental_health_entry_path, class: "btn btn-secondary" %>
      <% end %>
    </div>

    <div class="card">
      <h2>âœ… To-Do List</h2>
      <% if @pending_todos.any? %>
        <ul class="task-list">
          <% @pending_todos.each do |item| %>
            <li>
              <%= item.title %>
              <span class="badge <%= item.priority == 3 ? 'badge-info' : item.priority == 2 ? 'badge-pending' : 'badge-success' %>">
                <%= TodoItem::PRIORITIES[item.priority] %>
              </span>
            </li>
          <% end %>
        </ul>
      <% else %>
        <p class="empty-state">Nothing pending â€” great job!</p>
      <% end %>
      <%= link_to "View in Planner", planner_items_path, class: "btn btn-secondary" %>
    </div>

    <div class="card">
      <h2>ðŸ““ Journal</h2>
      <% if @recent_journal %>
        <p style="font-weight:600; margin-bottom:0.25rem;"><%= @recent_journal.title %></p>
        <p class="item-notes"><%= @recent_journal.date.strftime("%B %d, %Y") %></p>
        <% if @recent_journal.body.present? %>
          <p class="item-notes"><%= truncate(@recent_journal.body, length: 100) %></p>
        <% end %>
      <% else %>
        <p class="empty-state">No journal entries yet.</p>
      <% end %>
      <%= link_to "+ New Entry", new_journal_entry_path, class: "btn btn-secondary" %>
    </div>

    <div class="card">
      <h2>ðŸ”— Quick Links</h2>
      <ul class="quick-links">
        <li><%= link_to "ðŸ“… View Calendar", calendar_path %></li>
        <li><%= link_to "ðŸ“‹ Planner & To-Do", planner_items_path %></li>
        <li><%= link_to "ðŸ§  Mental Health, Medications & Journal", mental_health_entries_path %></li>
      </ul>
    </div>
  </div>
</div>
